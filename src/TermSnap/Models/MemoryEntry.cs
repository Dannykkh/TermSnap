using System;

namespace TermSnap.Models;

/// <summary>
/// AI ì¥ê¸°ê¸°ì–µ í•­ëª© (Mem0 ìŠ¤íƒ€ì¼)
/// </summary>
public class MemoryEntry
{
    /// <summary>
    /// ê³ ìœ  ID
    /// </summary>
    public int Id { get; set; }

    /// <summary>
    /// ë©”ëª¨ë¦¬ ë‚´ìš© (ì‚¬ì‹¤, ì„ í˜¸ë„, ê²½í—˜ ë“±)
    /// </summary>
    public string Content { get; set; } = string.Empty;

    /// <summary>
    /// ë©”ëª¨ë¦¬ íƒ€ì…
    /// </summary>
    public MemoryType Type { get; set; } = MemoryType.Fact;

    /// <summary>
    /// ë©”ëª¨ë¦¬ ì†ŒìŠ¤ (ëŒ€í™”ì—ì„œ ì¶”ì¶œëœ ì›ë¬¸)
    /// </summary>
    public string? Source { get; set; }

    /// <summary>
    /// ê´€ë ¨ ì£¼ì œ/ì»¨í…ìŠ¤íŠ¸
    /// </summary>
    public string? Context { get; set; }

    /// <summary>
    /// ì¤‘ìš”ë„ (0.0 ~ 1.0)
    /// </summary>
    public double Importance { get; set; } = 0.5;

    /// <summary>
    /// ìƒì„± ì‹œê°„
    /// </summary>
    public DateTime CreatedAt { get; set; } = DateTime.Now;

    /// <summary>
    /// ë§ˆì§€ë§‰ ì ‘ê·¼ ì‹œê°„
    /// </summary>
    public DateTime LastAccessedAt { get; set; } = DateTime.Now;

    /// <summary>
    /// ì ‘ê·¼ íšŸìˆ˜
    /// </summary>
    public int AccessCount { get; set; } = 0;

    /// <summary>
    /// ì„ë² ë”© ë²¡í„° (Base64 ì¸ì½”ë”©)
    /// </summary>
    public string? EmbeddingVector { get; set; }

    /// <summary>
    /// í™œì„±í™” ì—¬ë¶€
    /// </summary>
    public bool IsActive { get; set; } = true;

    /// <summary>
    /// ìë™ ìƒì„± ì—¬ë¶€ (AIê°€ ëŒ€í™”ì—ì„œ ì¶”ì¶œ)
    /// </summary>
    public bool IsAutoGenerated { get; set; } = false;

    /// <summary>
    /// ì„¸ì…˜ ID (ì–´ë–¤ ì„¸ì…˜ì—ì„œ ìƒì„±ë˜ì—ˆëŠ”ì§€)
    /// </summary>
    public string? SessionId { get; set; }

    #region Display Properties

    /// <summary>
    /// íƒ€ì… ì•„ì´ì½˜ (UI í‘œì‹œìš©)
    /// </summary>
    public string TypeIcon => Type switch
    {
        MemoryType.Fact => "ğŸ“Œ",
        MemoryType.Preference => "ğŸ’¡",
        MemoryType.TechStack => "ğŸ”§",
        MemoryType.Project => "ğŸ“",
        MemoryType.Instruction => "âš ï¸",
        MemoryType.Lesson => "ğŸ“š",
        MemoryType.Experience => "ğŸ¯",
        MemoryType.WorkPattern => "ğŸ”„",
        _ => "ğŸ“"
    };

    /// <summary>
    /// íƒ€ì… ì´ë¦„ (UI í‘œì‹œìš©)
    /// </summary>
    public string TypeName => Type switch
    {
        MemoryType.Fact => "ì‚¬ì‹¤",
        MemoryType.Preference => "ì„ í˜¸ë„",
        MemoryType.TechStack => "ê¸°ìˆ  ìŠ¤íƒ",
        MemoryType.Project => "í”„ë¡œì íŠ¸",
        MemoryType.Instruction => "ì§€ì¹¨",
        MemoryType.Lesson => "í•™ìŠµëœ êµí›ˆ",
        MemoryType.Experience => "ê²½í—˜",
        MemoryType.WorkPattern => "ì‘ì—… íŒ¨í„´",
        _ => "ê¸°íƒ€"
    };

    /// <summary>
    /// ì¤‘ìš”ë„ í…ìŠ¤íŠ¸ (UI í‘œì‹œìš©)
    /// </summary>
    public string ImportanceText => Importance switch
    {
        >= 0.8 => "ë†’ìŒ",
        >= 0.5 => "ë³´í†µ",
        _ => "ë‚®ìŒ"
    };

    /// <summary>
    /// ì†ŒìŠ¤ ì¡´ì¬ ì—¬ë¶€
    /// </summary>
    public bool HasSource => !string.IsNullOrEmpty(Source);

    /// <summary>
    /// ì ‘ê·¼ ì •ë³´ (UI í‘œì‹œìš©)
    /// </summary>
    public string AccessInfo => $"ì ‘ê·¼ {AccessCount}íšŒ";

    #endregion
}

/// <summary>
/// ë©”ëª¨ë¦¬ íƒ€ì…
/// </summary>
public enum MemoryType
{
    /// <summary>
    /// ì‚¬ì‹¤ (ì´ë¦„, ì§ì—…, ìœ„ì¹˜ ë“±)
    /// </summary>
    Fact,

    /// <summary>
    /// ì„ í˜¸ë„ (ì¢‹ì•„í•˜ëŠ” ê²ƒ, ì‹«ì–´í•˜ëŠ” ê²ƒ)
    /// </summary>
    Preference,

    /// <summary>
    /// ê²½í—˜ (ì´ì „ì— í–ˆë˜ ê²ƒ)
    /// </summary>
    Experience,

    /// <summary>
    /// í”„ë¡œì íŠ¸ ì •ë³´
    /// </summary>
    Project,

    /// <summary>
    /// ê¸°ìˆ  ìŠ¤íƒ
    /// </summary>
    TechStack,

    /// <summary>
    /// ì‘ì—… íŒ¨í„´
    /// </summary>
    WorkPattern,

    /// <summary>
    /// ì»¤ìŠ¤í…€ ì§€ì¹¨
    /// </summary>
    Instruction,

    /// <summary>
    /// í•™ìŠµëœ êµí›ˆ (ì˜¤ë¥˜/ì‹¤ìˆ˜ íŒ¨í„´)
    /// </summary>
    Lesson
}
