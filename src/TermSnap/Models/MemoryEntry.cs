using System;
using System.Windows.Media;

namespace TermSnap.Models;

/// <summary>
/// AI ì¥ê¸°ê¸°ì–µ í•­ëª© (claude-mem ìŠ¤íƒ€ì¼)
/// </summary>
public class MemoryEntry
{
    /// <summary>
    /// ê³ ìœ  ID
    /// </summary>
    public int Id { get; set; }

    /// <summary>
    /// ë©”ëª¨ë¦¬ ë‚´ìš© (ì‚¬ì‹¤, ì„ í˜¸ë„, ê²½í—˜ ë“±)
    /// </summary>
    public string Content { get; set; } = string.Empty;

    /// <summary>
    /// ë©”ëª¨ë¦¬ íƒ€ì…
    /// </summary>
    public MemoryType Type { get; set; } = MemoryType.Architecture;

    /// <summary>
    /// ë©”ëª¨ë¦¬ ì†ŒìŠ¤ (ëŒ€í™”ì—ì„œ ì¶”ì¶œëœ ì›ë¬¸)
    /// </summary>
    public string? Source { get; set; }

    /// <summary>
    /// ê´€ë ¨ ì£¼ì œ/ì»¨í…ìŠ¤íŠ¸
    /// </summary>
    public string? Context { get; set; }

    /// <summary>
    /// ì¤‘ìš”ë„ (0.0 ~ 1.0)
    /// </summary>
    public double Importance { get; set; } = 0.5;

    /// <summary>
    /// ìƒì„± ì‹œê°„
    /// </summary>
    public DateTime CreatedAt { get; set; } = DateTime.Now;

    /// <summary>
    /// ë§ˆì§€ë§‰ ì ‘ê·¼ ì‹œê°„
    /// </summary>
    public DateTime LastAccessedAt { get; set; } = DateTime.Now;

    /// <summary>
    /// ì ‘ê·¼ íšŸìˆ˜
    /// </summary>
    public int AccessCount { get; set; } = 0;

    /// <summary>
    /// ì„ë² ë”© ë²¡í„° (Base64 ì¸ì½”ë”©)
    /// </summary>
    public string? EmbeddingVector { get; set; }

    /// <summary>
    /// í™œì„±í™” ì—¬ë¶€
    /// </summary>
    public bool IsActive { get; set; } = true;

    /// <summary>
    /// ìë™ ìƒì„± ì—¬ë¶€ (AIê°€ ëŒ€í™”ì—ì„œ ì¶”ì¶œ)
    /// </summary>
    public bool IsAutoGenerated { get; set; } = false;

    /// <summary>
    /// ì„¸ì…˜ ID (ì–´ë–¤ ì„¸ì…˜ì—ì„œ ìƒì„±ë˜ì—ˆëŠ”ì§€)
    /// </summary>
    public string? SessionId { get; set; }

    #region Display Properties

    /// <summary>
    /// íƒ€ì… ì•„ì´ì½˜ (UI í‘œì‹œìš©) - ì»¨í…ìŠ¤íŠ¸ íŠ¸ë¦¬ êµ¬ì¡°
    /// </summary>
    public string TypeIcon => Type switch
    {
        MemoryType.Architecture => "ğŸ—ï¸",
        MemoryType.Pattern => "ğŸ”„",
        MemoryType.Tool => "ğŸ”§",
        MemoryType.Gotcha => "âš ï¸",
        MemoryType.Goal => "ğŸ¯",
        MemoryType.Meta => "ğŸ“",
        _ => "ğŸ“"
    };

    /// <summary>
    /// íƒ€ì… ì´ë¦„ (UI í‘œì‹œìš©) - ì»¨í…ìŠ¤íŠ¸ íŠ¸ë¦¬ êµ¬ì¡°
    /// </summary>
    public string TypeName => Type switch
    {
        MemoryType.Architecture => "ì•„í‚¤í…ì²˜",
        MemoryType.Pattern => "íŒ¨í„´",
        MemoryType.Tool => "ë„êµ¬",
        MemoryType.Gotcha => "ì£¼ì˜ì‚¬í•­",
        MemoryType.Goal => "ëª©í‘œ",
        MemoryType.Meta => "ë©”íƒ€",
        _ => "ê¸°íƒ€"
    };

    /// <summary>
    /// ì¤‘ìš”ë„ í…ìŠ¤íŠ¸ (UI í‘œì‹œìš©)
    /// </summary>
    public string ImportanceText => Importance switch
    {
        >= 0.8 => "ë†’ìŒ",
        >= 0.5 => "ë³´í†µ",
        _ => "ë‚®ìŒ"
    };

    /// <summary>
    /// ì†ŒìŠ¤ ì¡´ì¬ ì—¬ë¶€
    /// </summary>
    public bool HasSource => !string.IsNullOrEmpty(Source);

    /// <summary>
    /// ì»¨í…ìŠ¤íŠ¸ ì¡´ì¬ ì—¬ë¶€
    /// </summary>
    public bool HasContext => !string.IsNullOrEmpty(Context);

    /// <summary>
    /// ì ‘ê·¼ ì •ë³´ (UI í‘œì‹œìš©)
    /// </summary>
    public string AccessInfo => $"ì ‘ê·¼ {AccessCount}íšŒ";

    /// <summary>
    /// ìƒì„±ì¼ í‘œì‹œ (UIìš©)
    /// </summary>
    public string CreatedAtDisplay => CreatedAt.ToString("yyyy-MM-dd");

    /// <summary>
    /// íƒ€ì…ë³„ í…Œë‘ë¦¬ ìƒ‰ìƒ (claude-mem ìŠ¤íƒ€ì¼)
    /// </summary>
    public Brush TypeBorderBrush => Type switch
    {
        MemoryType.Architecture => new SolidColorBrush(Color.FromRgb(0x09, 0x69, 0xda)), // íŒŒë€ìƒ‰
        MemoryType.Pattern => new SolidColorBrush(Color.FromRgb(0x82, 0x50, 0xdf)),      // ë³´ë¼ìƒ‰
        MemoryType.Tool => new SolidColorBrush(Color.FromRgb(0x1a, 0x7f, 0x37)),         // ì´ˆë¡ìƒ‰
        MemoryType.Gotcha => new SolidColorBrush(Color.FromRgb(0xcf, 0x22, 0x2e)),       // ë¹¨ê°„ìƒ‰
        MemoryType.Goal => new SolidColorBrush(Color.FromRgb(0xd4, 0xa7, 0x2c)),         // ê¸ˆìƒ‰
        MemoryType.Meta => new SolidColorBrush(Color.FromRgb(0x6e, 0x77, 0x81)),         // íšŒìƒ‰
        _ => new SolidColorBrush(Color.FromRgb(0x6e, 0x77, 0x81))
    };

    /// <summary>
    /// íƒ€ì…ë³„ ë°°ê²½ ìƒ‰ìƒ (claude-mem ìŠ¤íƒ€ì¼)
    /// </summary>
    public Brush TypeBackgroundBrush => Type switch
    {
        MemoryType.Architecture => new SolidColorBrush(Color.FromRgb(0xf0, 0xf6, 0xfb)), // ì—°í•œ íŒŒë€
        MemoryType.Pattern => new SolidColorBrush(Color.FromRgb(0xf5, 0xf0, 0xff)),      // ì—°í•œ ë³´ë¼
        MemoryType.Tool => new SolidColorBrush(Color.FromRgb(0xf0, 0xff, 0xf4)),         // ì—°í•œ ì´ˆë¡
        MemoryType.Gotcha => new SolidColorBrush(Color.FromRgb(0xff, 0xf5, 0xf5)),       // ì—°í•œ ë¹¨ê°•
        MemoryType.Goal => new SolidColorBrush(Color.FromRgb(0xff, 0xfb, 0xf0)),         // ì—°í•œ ê¸ˆìƒ‰
        MemoryType.Meta => new SolidColorBrush(Color.FromRgb(0xf6, 0xf8, 0xfa)),         // ì—°í•œ íšŒìƒ‰
        _ => new SolidColorBrush(Color.FromRgb(0xf6, 0xf8, 0xfa))
    };

    #endregion
}

/// <summary>
/// ë©”ëª¨ë¦¬ íƒ€ì… (ì»¨í…ìŠ¤íŠ¸ íŠ¸ë¦¬ êµ¬ì¡°)
/// </summary>
public enum MemoryType
{
    /// <summary>
    /// ì•„í‚¤í…ì²˜ - ì„¤ê³„ ê²°ì •, ì•„í‚¤í…ì²˜ ì„ íƒ
    /// </summary>
    Architecture,

    /// <summary>
    /// íŒ¨í„´ - ì‘ì—… íŒ¨í„´, ì›Œí¬í”Œë¡œìš°
    /// </summary>
    Pattern,

    /// <summary>
    /// ë„êµ¬ - MCP ì„œë²„, ì™¸ë¶€ ë„êµ¬
    /// </summary>
    Tool,

    /// <summary>
    /// ì£¼ì˜ì‚¬í•­ - í•¨ì •, gotchas
    /// </summary>
    Gotcha,

    /// <summary>
    /// ëª©í‘œ - í”„ë¡œì íŠ¸ ëª©í‘œ
    /// </summary>
    Goal,

    /// <summary>
    /// ë©”íƒ€ - í”„ë¡œì íŠ¸ ì •ë³´
    /// </summary>
    Meta
}
