<UserControl x:Class="TermSnap.Views.FileViewerPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             Background="{DynamicResource SurfaceBrush}"
             Opacity="0.95">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 왼쪽 리사이즈 그립 (드래그하여 너비 조절) -->
        <Border x:Name="ResizeGrip"
                Grid.Column="0"
                Width="8"
                Background="{DynamicResource MaterialDesignDivider}"
                BorderBrush="{DynamicResource MaterialDesignDivider}"
                BorderThickness="1,0,0,0"
                Cursor="SizeWE"
                MouseLeftButtonDown="ResizeGrip_MouseLeftButtonDown"
                MouseLeftButtonUp="ResizeGrip_MouseLeftButtonUp"
                MouseMove="ResizeGrip_MouseMove"
                ToolTip="{DynamicResource FileViewer.DragToResize}">
            <Border.Style>
                <Style TargetType="Border">
                    <Setter Property="Background" Value="Transparent"/>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="{DynamicResource PrimaryHueMidBrush}"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>
            <!-- 시각적 표시 (3개 점) -->
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <Ellipse Width="3" Height="3" Fill="{DynamicResource TextSecondaryBrush}" Margin="0,2"/>
                <Ellipse Width="3" Height="3" Fill="{DynamicResource TextSecondaryBrush}" Margin="0,2"/>
                <Ellipse Width="3" Height="3" Fill="{DynamicResource TextSecondaryBrush}" Margin="0,2"/>
            </StackPanel>
        </Border>

        <!-- 메인 콘텐츠 -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

        <!-- 헤더 -->
        <Border Grid.Row="0"
                Background="{DynamicResource MaterialDesignToolBarBackground}"
                BorderBrush="{DynamicResource MaterialDesignDivider}"
                BorderThickness="0,0,0,1"
                Padding="8,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- 파일 아이콘 -->
                <materialDesign:PackIcon Grid.Column="0"
                                         x:Name="FileIcon"
                                         Kind="File"
                                         Width="20" Height="20"
                                         VerticalAlignment="Center"
                                         Margin="0,0,8,0"
                                         Foreground="{DynamicResource PrimaryBrush}"/>

                <!-- 파일명 -->
                <TextBlock Grid.Column="1"
                           x:Name="FileNameText"
                           Text="{DynamicResource FileViewer.SelectFile}"
                           FontSize="13"
                           FontWeight="Medium"
                           VerticalAlignment="Center"
                           TextTrimming="CharacterEllipsis"
                           Foreground="{DynamicResource TextPrimaryBrush}"
                           ToolTip="{Binding Text, RelativeSource={RelativeSource Self}}"/>

                <!-- 버튼들 -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <!-- 외부에서 열기 -->
                    <Button x:Name="OpenExternalBtn"
                            Style="{StaticResource MaterialDesignToolButton}"
                            Click="OpenExternal_Click"
                            ToolTip="{DynamicResource FileViewer.OpenWithDefault}"
                            Margin="4,0">
                        <materialDesign:PackIcon Kind="OpenInNew" Width="18" Height="18"
                                                 Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </Button>

                    <!-- 닫기 -->
                    <Button x:Name="CloseBtn"
                            Style="{StaticResource MaterialDesignToolButton}"
                            Click="Close_Click"
                            ToolTip="{DynamicResource FileViewer.Close}">
                        <materialDesign:PackIcon Kind="Close" Width="18" Height="18"
                                                 Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 콘텐츠 영역 -->
        <Grid Grid.Row="1">
            <!-- 빈 상태 -->
            <StackPanel x:Name="EmptyState"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Center"
                        Visibility="Visible">
                <materialDesign:PackIcon Kind="FileDocumentOutline"
                                         Width="48" Height="48"
                                         HorizontalAlignment="Center"
                                         Foreground="{DynamicResource TextSecondaryBrush}"
                                         Margin="0,0,0,12"/>
                <TextBlock Text="{DynamicResource FileViewer.EmptyMessage}"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           HorizontalAlignment="Center"/>
            </StackPanel>

            <!-- 텍스트/코드 뷰어 -->
            <ScrollViewer x:Name="TextViewer"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Auto"
                          Visibility="Collapsed">
                <TextBox x:Name="TextContent"
                         IsReadOnly="True"
                         FontFamily="Consolas"
                         FontSize="13"
                         Background="Transparent"
                         Foreground="{DynamicResource TextPrimaryBrush}"
                         BorderThickness="0"
                         TextWrapping="NoWrap"
                         AcceptsReturn="True"
                         Padding="12"/>
            </ScrollViewer>

            <!-- Markdown 뷰어 -->
            <ScrollViewer x:Name="MarkdownViewer"
                          VerticalScrollBarVisibility="Auto"
                          Visibility="Collapsed"
                          Padding="16">
                <RichTextBox x:Name="MarkdownContent"
                             IsReadOnly="True"
                             Background="Transparent"
                             Foreground="{DynamicResource TextPrimaryBrush}"
                             BorderThickness="0"
                             FontSize="14"/>
            </ScrollViewer>

            <!-- 이미지 뷰어 -->
            <ScrollViewer x:Name="ImageViewer"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Auto"
                          Visibility="Collapsed">
                <Image x:Name="ImageContent"
                       Stretch="None"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Margin="16"/>
            </ScrollViewer>

            <!-- 로딩 -->
            <ProgressBar x:Name="LoadingIndicator"
                         IsIndeterminate="True"
                         Visibility="Collapsed"
                         VerticalAlignment="Center"
                         Margin="32"/>
        </Grid>
        </Grid>
    </Grid>
</UserControl>
