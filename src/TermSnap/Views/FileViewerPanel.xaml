<UserControl x:Class="TermSnap.Views.FileViewerPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:avalonedit="http://icsharpcode.net/sharpdevelop/avalonedit"
             Background="{DynamicResource SurfaceBrush}"
             Opacity="0.95">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 왼쪽 리사이즈 그립 (드래그하여 너비 조절) -->
        <Border x:Name="ResizeGrip"
                Grid.Column="0"
                Width="8"
                Background="{DynamicResource MaterialDesignDivider}"
                BorderBrush="{DynamicResource MaterialDesignDivider}"
                BorderThickness="1,0,0,0"
                Cursor="SizeWE"
                MouseLeftButtonDown="ResizeGrip_MouseLeftButtonDown"
                MouseLeftButtonUp="ResizeGrip_MouseLeftButtonUp"
                MouseMove="ResizeGrip_MouseMove"
                ToolTip="{DynamicResource FileViewer.DragToResize}">
            <Border.Style>
                <Style TargetType="Border">
                    <Setter Property="Background" Value="Transparent"/>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="{DynamicResource PrimaryHueMidBrush}"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>
            <!-- 시각적 표시 (3개 점) -->
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <Ellipse Width="3" Height="3" Fill="{DynamicResource TextSecondaryBrush}" Margin="0,2"/>
                <Ellipse Width="3" Height="3" Fill="{DynamicResource TextSecondaryBrush}" Margin="0,2"/>
                <Ellipse Width="3" Height="3" Fill="{DynamicResource TextSecondaryBrush}" Margin="0,2"/>
            </StackPanel>
        </Border>

        <!-- 메인 콘텐츠 -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

        <!-- 헤더 -->
        <Border Grid.Row="0"
                Background="{DynamicResource MaterialDesignToolBarBackground}"
                BorderBrush="{DynamicResource MaterialDesignDivider}"
                BorderThickness="0,0,0,1"
                Padding="8,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- 파일 아이콘 -->
                <materialDesign:PackIcon Grid.Column="0"
                                         x:Name="FileIcon"
                                         Kind="File"
                                         Width="20" Height="20"
                                         VerticalAlignment="Center"
                                         Margin="0,0,8,0"
                                         Foreground="{DynamicResource PrimaryBrush}"/>

                <!-- 파일명 -->
                <TextBlock Grid.Column="1"
                           x:Name="FileNameText"
                           Text="{DynamicResource FileViewer.SelectFile}"
                           FontSize="13"
                           FontWeight="Medium"
                           VerticalAlignment="Center"
                           TextTrimming="CharacterEllipsis"
                           Foreground="{DynamicResource TextPrimaryBrush}"
                           ToolTip="{Binding Text, RelativeSource={RelativeSource Self}}"/>

                <!-- 버튼들 -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <!-- 저장 (편집 모드에서만 표시) -->
                    <Button x:Name="SaveBtn"
                            Style="{StaticResource MaterialDesignToolButton}"
                            Click="Save_Click"
                            ToolTip="저장 (Ctrl+S)"
                            Margin="4,0"
                            Visibility="Collapsed">
                        <materialDesign:PackIcon Kind="ContentSave" Width="18" Height="18"
                                                 Foreground="{DynamicResource PrimaryBrush}"/>
                    </Button>

                    <!-- 편집 모드 토글 -->
                    <Button x:Name="EditToggleBtn"
                            Style="{StaticResource MaterialDesignToolButton}"
                            Click="EditToggle_Click"
                            ToolTip="편집 모드 (Ctrl+E)"
                            Margin="4,0">
                        <materialDesign:PackIcon x:Name="EditToggleIcon" Kind="Pencil" Width="18" Height="18"
                                                 Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </Button>

                    <!-- 외부에서 열기 -->
                    <Button x:Name="OpenExternalBtn"
                            Style="{StaticResource MaterialDesignToolButton}"
                            Click="OpenExternal_Click"
                            ToolTip="{DynamicResource FileViewer.OpenWithDefault}"
                            Margin="4,0">
                        <materialDesign:PackIcon Kind="OpenInNew" Width="18" Height="18"
                                                 Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </Button>

                    <!-- 닫기 -->
                    <Button x:Name="CloseBtn"
                            Style="{StaticResource MaterialDesignToolButton}"
                            Click="Close_Click"
                            ToolTip="{DynamicResource FileViewer.Close}">
                        <materialDesign:PackIcon Kind="Close" Width="18" Height="18"
                                                 Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 콘텐츠 영역 -->
        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <!-- 콘텐츠 그리드 -->
            <Grid Grid.Row="0">
            <!-- 빈 상태 -->
            <StackPanel x:Name="EmptyState"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Center"
                        Visibility="Visible">
                <materialDesign:PackIcon Kind="FileDocumentOutline"
                                         Width="48" Height="48"
                                         HorizontalAlignment="Center"
                                         Foreground="{DynamicResource TextSecondaryBrush}"
                                         Margin="0,0,0,12"/>
                <TextBlock Text="{DynamicResource FileViewer.EmptyMessage}"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           HorizontalAlignment="Center"/>
            </StackPanel>

            <!-- 텍스트/코드 뷰어 (AvalonEdit with line numbers) -->
            <Border x:Name="TextViewer"
                    Visibility="Collapsed"
                    Background="Transparent">
                <avalonedit:TextEditor x:Name="TextEditor"
                                       IsReadOnly="True"
                                       FontFamily="Consolas"
                                       FontSize="13"
                                       Background="Transparent"
                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                       BorderThickness="0"
                                       ShowLineNumbers="True"
                                       LineNumbersForeground="{DynamicResource TextSecondaryBrush}"
                                       HorizontalScrollBarVisibility="Auto"
                                       VerticalScrollBarVisibility="Auto"
                                       Padding="8,12,12,12"/>
            </Border>

            <!-- Markdown 뷰어 -->
            <ScrollViewer x:Name="MarkdownViewer"
                          VerticalScrollBarVisibility="Auto"
                          Visibility="Collapsed"
                          Padding="16">
                <RichTextBox x:Name="MarkdownContent"
                             IsReadOnly="True"
                             Background="Transparent"
                             Foreground="{DynamicResource TextPrimaryBrush}"
                             BorderThickness="0"
                             FontSize="14"/>
            </ScrollViewer>

            <!-- 이미지 뷰어 -->
            <ScrollViewer x:Name="ImageViewer"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Auto"
                          Visibility="Collapsed">
                <Image x:Name="ImageContent"
                       Stretch="None"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Margin="16"/>
            </ScrollViewer>

            <!-- 로딩 -->
            <ProgressBar x:Name="LoadingIndicator"
                         IsIndeterminate="True"
                         Visibility="Collapsed"
                         VerticalAlignment="Center"
                         Margin="32"/>
            </Grid> <!-- 콘텐츠 그리드 닫기 -->

            <!-- 상태바 -->
            <Border x:Name="StatusBar"
                    Grid.Row="1"
                    Background="{DynamicResource MaterialDesignToolBarBackground}"
                    BorderBrush="{DynamicResource MaterialDesignDivider}"
                    BorderThickness="0,1,0,0"
                    Padding="8,4"
                    Visibility="Collapsed">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- 왼쪽: 커서 위치 -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <TextBlock x:Name="CursorPositionText"
                                   Text="줄 1, 열 1"
                                   FontSize="11"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- 오른쪽: 상태 정보 -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <!-- 줄바꿈 토글 -->
                        <Button x:Name="WordWrapBtn"
                                Style="{StaticResource MaterialDesignToolButton}"
                                Click="WordWrap_Click"
                                ToolTip="자동 줄바꿈"
                                Margin="0,0,8,0"
                                Height="20" Width="20">
                            <materialDesign:PackIcon x:Name="WordWrapIcon" Kind="Wrap" Width="14" Height="14"
                                                     Foreground="{DynamicResource TextSecondaryBrush}"/>
                        </Button>

                        <!-- 구분선 -->
                        <Border Width="1" Background="{DynamicResource MaterialDesignDivider}" Margin="4,2"/>

                        <!-- 줄 끝 문자 -->
                        <TextBlock x:Name="LineEndingText"
                                   Text="CRLF"
                                   FontSize="11"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   VerticalAlignment="Center"
                                   Margin="8,0"/>

                        <!-- 구분선 -->
                        <Border Width="1" Background="{DynamicResource MaterialDesignDivider}" Margin="4,2"/>

                        <!-- 인코딩 -->
                        <TextBlock x:Name="EncodingText"
                                   Text="UTF-8"
                                   FontSize="11"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   VerticalAlignment="Center"
                                   Margin="8,0,0,0"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
        </Grid>
    </Grid>
</UserControl>
