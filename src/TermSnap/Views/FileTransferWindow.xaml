<Window x:Class="TermSnap.Views.FileTransferWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="파일 전송 (SFTP)"
        Height="700"
        Width="1000"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource SurfaceBrush}">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <!-- DataGrid Row Style for Dark Theme -->
        <Style x:Key="ThemedDataGridRowStyle" TargetType="DataGridRow">
            <Setter Property="Background" Value="{DynamicResource CardBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{DynamicResource PrimaryLightBrush}"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource PrimaryLightBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- DataGrid Cell Style -->
        <Style x:Key="ThemedDataGridCellStyle" TargetType="DataGridCell">
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,4"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- DataGrid Header Style -->
        <Style x:Key="ThemedDataGridColumnHeaderStyle" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="{DynamicResource CardBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,0,2"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 제목 -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
            <materialDesign:PackIcon Kind="FolderNetwork"
                                     Width="28" Height="28"
                                     VerticalAlignment="Center"
                                     Foreground="{DynamicResource PrimaryBrush}"/>
            <TextBlock Text="파일 전송 관리"
                       FontSize="20"
                       FontWeight="Bold"
                       Foreground="{DynamicResource TextPrimaryBrush}"
                       VerticalAlignment="Center"
                       Margin="10,0,0,0"/>
        </StackPanel>

        <!-- 경로 및 네비게이션 -->
        <Grid Grid.Row="1" Margin="0,0,0,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Content="뒤로"
                    Width="80"
                    Margin="0,0,10,0"
                    Click="BackButton_Click"
                    Style="{StaticResource MaterialDesignOutlinedButton}"/>

            <TextBox x:Name="PathTextBox"
                     Grid.Column="1"
                     materialDesign:HintAssist.Hint="원격 경로"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     KeyDown="PathTextBox_KeyDown"/>

            <Button Grid.Column="2"
                    Content="이동"
                    Width="80"
                    Margin="10,0,0,0"
                    Click="GoButton_Click"
                    Style="{StaticResource MaterialDesignRaisedButton}"/>

            <Button Grid.Column="3"
                    Content="새로고침"
                    Width="100"
                    Margin="10,0,0,0"
                    Click="RefreshButton_Click"
                    Style="{StaticResource MaterialDesignRaisedButton}"/>
        </Grid>

        <!-- 파일 리스트 -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <DataGrid x:Name="FilesDataGrid"
                      Grid.Column="0"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      Background="{DynamicResource SurfaceBrush}"
                      RowBackground="{DynamicResource CardBrush}"
                      AlternatingRowBackground="{DynamicResource SurfaceBrush}"
                      BorderBrush="{DynamicResource BorderBrush}"
                      GridLinesVisibility="Horizontal"
                      HorizontalGridLinesBrush="{DynamicResource BorderBrush}"
                      RowStyle="{StaticResource ThemedDataGridRowStyle}"
                      CellStyle="{StaticResource ThemedDataGridCellStyle}"
                      ColumnHeaderStyle="{StaticResource ThemedDataGridColumnHeaderStyle}"
                      MouseDoubleClick="FilesDataGrid_MouseDoubleClick">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="아이콘"
                                        Binding="{Binding Icon}"
                                        Width="50"/>
                    <DataGridTextColumn Header="이름"
                                        Binding="{Binding Name}"
                                        Width="*"/>
                    <DataGridTextColumn Header="크기"
                                        Binding="{Binding SizeFormatted}"
                                        Width="100"/>
                    <DataGridTextColumn Header="수정일"
                                        Binding="{Binding LastModified, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"
                                        Width="150"/>
                    <DataGridTextColumn Header="권한"
                                        Binding="{Binding Permissions}"
                                        Width="100">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontFamily" Value="Consolas"/>
                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>

            <!-- 버튼 패널 -->
            <StackPanel Grid.Column="1"
                        Margin="15,0,0,0"
                        VerticalAlignment="Top">
                <Button Content="업로드"
                        Width="120"
                        Margin="0,0,0,10"
                        Click="UploadButton_Click"
                        Style="{StaticResource MaterialDesignRaisedButton}"/>
                <Button Content="다운로드"
                        Width="120"
                        Margin="0,0,0,10"
                        Click="DownloadButton_Click"
                        Style="{StaticResource MaterialDesignRaisedButton}"/>
                <Button Content="폴더 생성"
                        Width="120"
                        Margin="0,0,0,10"
                        Click="CreateFolderButton_Click"
                        Style="{StaticResource MaterialDesignOutlinedButton}"/>
                <Button Content="이름 변경"
                        Width="120"
                        Margin="0,0,0,10"
                        Click="RenameButton_Click"
                        Style="{StaticResource MaterialDesignOutlinedButton}"/>
                <Button Content="삭제"
                        Width="120"
                        Margin="0,0,0,10"
                        Click="DeleteButton_Click"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        Foreground="{DynamicResource ErrorBrush}"/>
            </StackPanel>
        </Grid>

        <!-- 진행률 -->
        <Border Grid.Row="3"
                Margin="0,15,0,0"
                Padding="15"
                Background="{DynamicResource CardBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="5"
                Visibility="{Binding IsTransferring, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel>
                <TextBlock x:Name="TransferStatusText"
                           Text="파일 전송 중..."
                           FontWeight="Bold"
                           Foreground="{DynamicResource TextPrimaryBrush}"
                           Margin="0,0,0,10"/>
                <ProgressBar x:Name="TransferProgressBar"
                             Height="10"
                             Minimum="0"
                             Maximum="100"
                             Value="0"/>
                <TextBlock x:Name="TransferDetailsText"
                           Text="0 / 0 MB (0%)"
                           Margin="0,5,0,0"
                           FontSize="12"
                           Foreground="{DynamicResource TextSecondaryBrush}"/>
            </StackPanel>
        </Border>

        <!-- 하단 버튼 -->
        <StackPanel Grid.Row="4"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,20,0,0">
            <TextBlock x:Name="CountTextBlock"
                       VerticalAlignment="Center"
                       Margin="0,0,20,0"
                       Foreground="{DynamicResource TextSecondaryBrush}"/>
            <Button Content="닫기"
                    Width="100"
                    Click="CloseButton_Click"
                    Style="{StaticResource MaterialDesignOutlinedButton}"/>
        </StackPanel>
    </Grid>
</Window>
