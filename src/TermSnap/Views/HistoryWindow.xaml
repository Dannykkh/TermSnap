<Window x:Class="TermSnap.Views.HistoryWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:local="clr-namespace:TermSnap.Views"
        Title="{DynamicResource History.Title}"
        Height="600"
        Width="900"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource BackgroundBrush}">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 제목 -->
        <TextBlock Grid.Row="0"
                   Text="{DynamicResource History.ExecutionHistory}"
                   FontSize="20"
                   FontWeight="Bold"
                   Foreground="{DynamicResource TextPrimaryBrush}"
                   Margin="0,0,0,20"/>

        <!-- 검색 및 필터 -->
        <Grid Grid.Row="1" Margin="0,0,0,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBox x:Name="SearchTextBox"
                     Grid.Column="0"
                     materialDesign:HintAssist.Hint="{DynamicResource History.SearchHint}"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     Background="{DynamicResource CardBrush}"
                     CaretBrush="{DynamicResource TextPrimaryBrush}"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     TextChanged="SearchTextBox_TextChanged"/>

            <ComboBox x:Name="ProfileFilterComboBox"
                      Grid.Column="1"
                      Width="150"
                      Margin="10,0,0,0"
                      Foreground="{DynamicResource TextPrimaryBrush}"
                      Background="{DynamicResource CardBrush}"
                      materialDesign:HintAssist.Hint="{DynamicResource History.ProfileFilter}"
                      Style="{StaticResource MaterialDesignOutlinedComboBox}"
                      SelectionChanged="ProfileFilterComboBox_SelectionChanged"/>

            <CheckBox x:Name="SuccessOnlyCheckBox"
                      Grid.Column="2"
                      Content="{DynamicResource History.SuccessOnly}"
                      Foreground="{DynamicResource TextPrimaryBrush}"
                      Margin="15,0,0,0"
                      VerticalAlignment="Center"
                      Checked="SuccessOnlyCheckBox_Changed"
                      Unchecked="SuccessOnlyCheckBox_Changed"/>

            <Button Grid.Column="3"
                    Content="{DynamicResource History.Clear}"
                    Width="80"
                    Margin="15,0,0,0"
                    Padding="5,3"
                    Click="ClearButton_Click"/>
        </Grid>

        <!-- 히스토리 리스트 -->
        <DataGrid x:Name="HistoryDataGrid"
                  Grid.Row="2"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  SelectionMode="Single"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  Background="{DynamicResource CardBrush}"
                  Foreground="{DynamicResource TextPrimaryBrush}"
                  RowBackground="{DynamicResource CardBrush}"
                  AlternatingRowBackground="{DynamicResource SurfaceBrush}"
                  BorderBrush="{DynamicResource BorderBrush}"
                  GridLinesVisibility="Horizontal"
                  HorizontalGridLinesBrush="{DynamicResource BorderBrush}"
                  MouseDoubleClick="HistoryDataGrid_MouseDoubleClick">
            <DataGrid.ColumnHeaderStyle>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                    <Setter Property="Padding" Value="10,8"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                    <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                </Style>
            </DataGrid.ColumnHeaderStyle>
            <DataGrid.Columns>
                <DataGridTextColumn Header="{DynamicResource History.Time}"
                                    Binding="{Binding ExecutedAt, StringFormat='{}{0:MM/dd HH:mm:ss}'}"
                                    Width="120"/>
                <DataGridTextColumn Header="{DynamicResource History.Profile}"
                                    Binding="{Binding ProfileName}"
                                    Width="100"/>
                <DataGridTextColumn Header="{DynamicResource History.UserRequest}"
                                    Binding="{Binding UserRequest}"
                                    Width="200"/>
                <DataGridTextColumn Header="{DynamicResource History.Command}"
                                    Binding="{Binding GeneratedCommand}"
                                    Width="*">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="FontFamily" Value="Consolas"/>
                            <Setter Property="TextWrapping" Value="NoWrap"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTemplateColumn Header="{DynamicResource History.Status}" Width="60">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding IsSuccess, Converter={StaticResource StatusConverter}}"
                                       HorizontalAlignment="Center"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Header="{DynamicResource History.Edited}" Width="70">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding WasEdited, Converter={StaticResource BoolConverter}}"
                                       HorizontalAlignment="Center"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- 버튼 -->
        <StackPanel Grid.Row="3"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,20,0,0">
            <TextBlock x:Name="CountTextBlock"
                       VerticalAlignment="Center"
                       Margin="0,0,20,0"
                       Foreground="{DynamicResource TextSecondaryBrush}"/>
            <Button Content="{DynamicResource Common.Close}"
                    Width="100"
                    Margin="0,0,10,0"
                    Padding="5,3"
                    Click="CloseButton_Click"/>
            <Button Content="{DynamicResource History.Select}"
                    Width="100"
                    Padding="5,3"
                    Click="SelectButton_Click"/>
        </StackPanel>
    </Grid>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

        <local:StatusIconConverter x:Key="StatusConverter"/>
        <local:BoolToYesNoConverter x:Key="BoolConverter"/>
    </Window.Resources>
</Window>
