<Window x:Class="Nebula.Views.HistorySearchPopup"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="명령어 히스토리 검색"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Width="600"
        Height="400"
        ShowInTaskbar="False"
        Topmost="True"
        KeyDown="Window_KeyDown">

    <Border Background="White"
            BorderBrush="#1976D2"
            BorderThickness="2"
            CornerRadius="8"
            Margin="10">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20" ShadowDepth="5" Opacity="0.3"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 헤더 -->
            <Border Grid.Row="0" Background="#1976D2" CornerRadius="6,6,0,0" Padding="15,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <materialDesign:PackIcon Kind="History" 
                                             Width="24" Height="24"
                                             Foreground="White"
                                             VerticalAlignment="Center"/>
                    
                    <TextBox Grid.Column="1"
                             x:Name="SearchTextBox"
                             Margin="15,0"
                             FontSize="16"
                             Background="White"
                             Padding="10,8"
                             BorderThickness="0"
                             materialDesign:HintAssist.Hint="검색어 입력... (Ctrl+R)"
                             TextChanged="SearchTextBox_TextChanged"/>

                    <Button Grid.Column="2"
                            Style="{StaticResource MaterialDesignFlatButton}"
                            Foreground="White"
                            Click="CloseButton_Click"
                            Padding="4">
                        <materialDesign:PackIcon Kind="Close" Width="20" Height="20"/>
                    </Button>
                </Grid>
            </Border>

            <!-- 검색 결과 목록 -->
            <ListBox Grid.Row="1"
                     x:Name="ResultsListBox"
                     Margin="0"
                     BorderThickness="0"
                     VirtualizingPanel.IsVirtualizing="True"
                     SelectionChanged="ResultsListBox_SelectionChanged"
                     MouseDoubleClick="ResultsListBox_MouseDoubleClick">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Padding="12,8" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- 사용자 입력 (자연어) -->
                                <TextBlock Grid.Row="0"
                                           Text="{Binding UserInput}"
                                           FontWeight="Medium"
                                           FontSize="13"
                                           Foreground="#212121"
                                           TextTrimming="CharacterEllipsis"/>

                                <!-- 생성된 명령어 -->
                                <TextBlock Grid.Row="1"
                                           Text="{Binding GeneratedCommand}"
                                           FontFamily="Consolas"
                                           FontSize="12"
                                           Foreground="#1976D2"
                                           Margin="0,4,0,0"
                                           TextTrimming="CharacterEllipsis"/>

                                <!-- 메타 정보 -->
                                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,4,0,0">
                                    <TextBlock Text="{Binding ExecutedAt, StringFormat='yyyy-MM-dd HH:mm'}"
                                               FontSize="10"
                                               Foreground="#9E9E9E"/>
                                    <TextBlock Text="•" Margin="8,0" FontSize="10" Foreground="#9E9E9E"/>
                                    <TextBlock FontSize="10">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Foreground" Value="#4CAF50"/>
                                                <Setter Property="Text" Value="성공"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsSuccess}" Value="False">
                                                        <Setter Property="Foreground" Value="#F44336"/>
                                                        <Setter Property="Text" Value="실패"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                    <TextBlock Text="•" Margin="8,0" FontSize="10" Foreground="#9E9E9E"/>
                                    <TextBlock Text="{Binding ServerProfile}"
                                               FontSize="10"
                                               Foreground="#9E9E9E"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <!-- 푸터 -->
            <Border Grid.Row="2" Background="#F5F5F5" Padding="15,10" CornerRadius="0,0,6,6">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="↑↓ 선택" FontSize="11" Foreground="#757575"/>
                    <TextBlock Text="•" Margin="10,0" FontSize="11" Foreground="#BDBDBD"/>
                    <TextBlock Text="Enter 사용" FontSize="11" Foreground="#757575"/>
                    <TextBlock Text="•" Margin="10,0" FontSize="11" Foreground="#BDBDBD"/>
                    <TextBlock Text="Esc 닫기" FontSize="11" Foreground="#757575"/>
                </StackPanel>
            </Border>
        </Grid>
    </Border>
</Window>
