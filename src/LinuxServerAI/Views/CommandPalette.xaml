<Window x:Class="Nebula.Views.CommandPalette"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Command Palette"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Width="650"
        Height="450"
        ShowInTaskbar="False"
        Topmost="True"
        KeyDown="Window_KeyDown">

    <Border Background="White"
            BorderBrush="#673AB7"
            BorderThickness="2"
            CornerRadius="8"
            Margin="10">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20" ShadowDepth="5" Opacity="0.3"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 헤더 -->
            <Border Grid.Row="0" Background="#673AB7" CornerRadius="6,6,0,0" Padding="15,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <materialDesign:PackIcon Kind="MagnifyExpand" 
                                             Width="24" Height="24"
                                             Foreground="White"
                                             VerticalAlignment="Center"/>
                    
                    <TextBox Grid.Column="1"
                             x:Name="SearchTextBox"
                             Margin="15,0"
                             FontSize="16"
                             Background="White"
                             Padding="10,8"
                             BorderThickness="0"
                             materialDesign:HintAssist.Hint="> 명령어, 스니펫, 히스토리 검색..."
                             TextChanged="SearchTextBox_TextChanged"/>

                    <Button Grid.Column="2"
                            Style="{StaticResource MaterialDesignFlatButton}"
                            Foreground="White"
                            Click="CloseButton_Click"
                            Padding="4">
                        <materialDesign:PackIcon Kind="Close" Width="20" Height="20"/>
                    </Button>
                </Grid>
            </Border>

            <!-- 필터 탭 -->
            <Border Grid.Row="0" VerticalAlignment="Bottom" Margin="15,-30,15,0">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <RadioButton x:Name="FilterAll" Content="전체" IsChecked="True" 
                                 Style="{StaticResource MaterialDesignTabRadioButton}"
                                 Margin="0,0,5,0" Checked="Filter_Changed"/>
                    <RadioButton x:Name="FilterHistory" Content="히스토리" 
                                 Style="{StaticResource MaterialDesignTabRadioButton}"
                                 Margin="5,0" Checked="Filter_Changed"/>
                    <RadioButton x:Name="FilterSnippets" Content="스니펫" 
                                 Style="{StaticResource MaterialDesignTabRadioButton}"
                                 Margin="5,0" Checked="Filter_Changed"/>
                    <RadioButton x:Name="FilterActions" Content="액션" 
                                 Style="{StaticResource MaterialDesignTabRadioButton}"
                                 Margin="5,0,0,0" Checked="Filter_Changed"/>
                </StackPanel>
            </Border>

            <!-- 검색 결과 목록 -->
            <ListBox Grid.Row="1"
                     x:Name="ResultsListBox"
                     Margin="0,40,0,0"
                     BorderThickness="0"
                     VirtualizingPanel.IsVirtualizing="True"
                     MouseDoubleClick="ResultsListBox_MouseDoubleClick">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Padding="12,10" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- 아이콘 -->
                                <Border Grid.Column="0" 
                                        Width="32" Height="32" 
                                        CornerRadius="4"
                                        Background="{Binding IconBackground}"
                                        Margin="0,0,12,0">
                                    <materialDesign:PackIcon Kind="{Binding Icon}" 
                                                             Width="18" Height="18"
                                                             Foreground="White"
                                                             HorizontalAlignment="Center"
                                                             VerticalAlignment="Center"/>
                                </Border>

                                <!-- 내용 -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Title}"
                                               FontWeight="Medium"
                                               FontSize="13"
                                               Foreground="#212121"/>
                                    <TextBlock Text="{Binding Subtitle}"
                                               FontSize="11"
                                               Foreground="#757575"
                                               TextTrimming="CharacterEllipsis"
                                               Margin="0,2,0,0"/>
                                </StackPanel>

                                <!-- 타입 배지 -->
                                <Border Grid.Column="2"
                                        Background="{Binding TypeBackground}"
                                        CornerRadius="10"
                                        Padding="8,3"
                                        VerticalAlignment="Center">
                                    <TextBlock Text="{Binding TypeText}"
                                               FontSize="10"
                                               Foreground="White"/>
                                </Border>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <!-- 결과 없음 -->
            <StackPanel Grid.Row="1" 
                        VerticalAlignment="Center" 
                        HorizontalAlignment="Center"
                        x:Name="NoResultsPanel"
                        Visibility="Collapsed">
                <materialDesign:PackIcon Kind="MagnifyClose"
                                         Width="48" Height="48"
                                         Foreground="#BDBDBD"
                                         HorizontalAlignment="Center"/>
                <TextBlock Text="검색 결과가 없습니다"
                           FontSize="14"
                           Foreground="#9E9E9E"
                           Margin="0,12,0,0"
                           HorizontalAlignment="Center"/>
            </StackPanel>

            <!-- 푸터 -->
            <Border Grid.Row="2" Background="#F5F5F5" Padding="15,10" CornerRadius="0,0,6,6">
                <Grid>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="↑↓ 선택" FontSize="11" Foreground="#757575"/>
                        <TextBlock Text="•" Margin="10,0" FontSize="11" Foreground="#BDBDBD"/>
                        <TextBlock Text="Enter 실행" FontSize="11" Foreground="#757575"/>
                        <TextBlock Text="•" Margin="10,0" FontSize="11" Foreground="#BDBDBD"/>
                        <TextBlock Text="Esc 닫기" FontSize="11" Foreground="#757575"/>
                    </StackPanel>
                    <TextBlock HorizontalAlignment="Right" 
                               FontSize="11" 
                               Foreground="#9E9E9E"
                               x:Name="ResultCountText"/>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
